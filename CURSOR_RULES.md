# Cursor Rules — меню, глобальные переменные и z-index

Документ регламентирует правила, предотвращающие ошибки меню (ReferenceError, некликабельность, конфликты переменных) и проблемы с перекрытием UI.

## 1) Глобальные переменные и области видимости
- Не дублировать имена глобальных переменных в разных скриптах. Если идентификатор уже используется, выбрать уникальное имя.
  - Пример: `deferredPrompt` — занято в `script.js`; во встроенных скриптах использовать `deferredPromptHtml`.
- Не переопределять функции, определённые в других скриптах (например, `toggleMenu`, `closeMenu`).
- Для новых глобальных сущностей использовать неймспейс: `window.app = window.app || {};` и располагать значения внутри `window.app`.

## 2) Обработчики событий меню
- Не полагаться только на inline-обработчики (`onclick`).
  - На `DOMContentLoaded` дублировать привязку через `addEventListener`, но только если inline-обработчик недоступен:
    ```js
    const btn = document.getElementById('hamburger-btn');
    if (btn && typeof btn.onclick !== 'function') {
      btn.addEventListener('click', toggleMenu, { passive: true });
    }
    ```
- Функции, вызываемые из inline-обработчиков (например, `toggleMenu`, `closeMenu`), должны быть доступны в глобальной области.
- Для оверлеев и модалок проверять `pointer-events` и `z-index`, чтобы не блокировать навигацию.

## 3) Слои интерфейса (z-index) и перекрытия
- Критичные элементы навигации не должны перекрываться временными баннерами/оверлеями.
  - Политика уровней:
    - `.hamburger-btn` (кнопка меню): `z-index ≥ 11000`
    - Сервисные баннеры (обновление SW, уведомления, достижения): `z-index ≤ 10000`
    - Затемнение меню `.menu-overlay`: ниже `.hamburger-btn`
- При добавлении fixed-элементов проводить клик‑тест в зоне кнопки меню (правый верхний угол) на desktop и mobile.

## 4) CSP-совместимость
- Поддерживать работу при строгой CSP (без inline-скриптов):
  - Дублировать критичные обработчики через `addEventListener` на `DOMContentLoaded` (см. пункт 2).
  - Не использовать `eval` или динамическую генерацию кода.

## 5) Регрессионный чек-лист для меню
- Кнопка «Меню» кликается при активном баннере обновления (desktop и mobile).
- В консоли отсутствуют `ReferenceError`/`SyntaxError` от скриптов меню.
- Открытие/закрытие работает: по кнопке меню, по крестику в заголовке, по клику на затемнение.
- `toggleMenu`/`closeMenu` доступны из глобальной области.

## 6) Требования к PR, затрагивающим меню/оверлеи
- Приложить короткий скринкаст клика по кнопке «Меню» при активном сервисном баннере.
- Убедиться в наличии в DOM: `#hamburger-btn`, `#sidebar-menu`, `#menu-overlay`.
- Проверить, что `.hamburger-btn { z-index: 11000; }` сохранён.

Последнее обновление: 2025‑09‑14
